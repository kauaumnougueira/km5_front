<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="csrf-token" content="{{ csrf_token() }}">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <link rel="stylesheet" href="style/style.css">
    <title>Perfil</title>
</head>
<body>
    <div class="container shadow-lg bg-light">
        <div class="row justify-content-md-center" id="perfil-header">
            <div class="col-11 p-4">
                <form id="perfil">
                    <div class="form-group">
                        <div class="row justify-content-md-center">
                            <div class="col-1">
                                <label>Nome</label>
                            </div>
                            <div class="col-8">
                                <input type="text" class="form-control" name="nome" required>
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="row justify-content-md-center">
                            <div class="col-1">
                                <label>Telefone</label>
                            </div>
                            <div class="col-8">
                                <input type="text" class="form-control" name="telefone" required>
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="row justify-content-md-center">
                            <div class="col-1">
                                <label>Endereço</label>
                            </div>
                            <div class="col-8">
                                <input type="text" class="form-control" name="endereco" required>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <button onclick="window.editar()" class="btn btn-primary rounded-0 col-1" id="btn" type="submit">editar</button>
        </div>
    </div>
</body>
<script type="module">

    const token = document.head.querySelector('meta[name="csrf-token"]').getAttribute('content');

    //ADCIONAR CONTEUDO DO INPUT COM O GET DO CLIENTE BY YOUR NAME OR ID, GERENCIAR ISSO DA MELHRO FORMA DEPENDENDO DECOMO ESSA PAGINA FOI ACESSADA
    const inputs = [...document.getElementsByTagName('input')]
    //LEMBRAR DE FAZER /PERFIL SER INACESSIVEL, JA QUE NAO DA PRA SABER QUAL PERFIL VOCE VAI VISITAR
    const btn = document.getElementById('btn')
    const perfil = document.getElementById('perfil')

    let inputsvalue = []

    // Função para obter o valor de um cookie por nome -- chatgpt
    function getCookie(name) {
    var cookies = document.cookie.split(';');
    for (var i = 0; i < cookies.length; i++) {
        var cookie = cookies[i].trim();
        if (cookie.startsWith(name + "=")) {
        return cookie.substring(name.length + 1);
        }
    }
    return null;
    }

    const id = getCookie("id");

    inputs.forEach(e => {
        
        e.setAttribute('disabled', "")
    })
    
    let i = 0
    function editar(){
        //libera inputs
        inputs.forEach(e => {
            inputsvalue[i] = e.value
            console.log(inputsvalue[i])
            console.log(e.value)
            i++
            e.removeAttribute('disabled')
        })

        inputs.forEach(e => {
            e.addEventListener('input', () =>{ //mudança no input
                //trocar atributos do button
                btn.innerHTML = 'salvar'
                btn.classList.remove('btn-primary')
                btn.classList.add('btn-danger')
                btn.removeEventListener('click', editar);
                btn.addEventListener('click', salvar);
            })
        })
        
   }

    function salvar(){
        //mandar dados
        const formData = new FormData(perfil)

        if(inputsvalue[0] !== formData.get('nome') || inputsvalue[1] !== formData.get('telefone') || inputsvalue[2] !== formData.get('endereco')){
            console.log(inputsvalue[0])
            console.log(formData.get('nome'))
            import('./js/apiConsumo.js').then(({ editarCliente }) => {
                editarCliente(token, formData, id)
            })
        }
        
        //trocar atributos do button
        btn.innerHTML = 'editar'
        btn.classList.remove('btn-danger')
        btn.classList.add('btn-primary')
        btn.removeEventListener('click', salvar);
        btn.addEventListener('click', editar);

        //tranca inputs
        inputs.forEach(e => {
            e.setAttribute('disabled', "")
        })
    }

    window.editar = editar

    window.onload = alimentacao()
    function alimentacao(){
        import('./js/apiConsumo.js').then(({ getCliente }) => {
            getCliente(token, id).then(data => {
                inputs[0].setAttribute('value', data.nome)
                inputs[1].setAttribute('value', data.telefone)
                inputs[2].setAttribute('value', data.endereco)
            })
        })
    }

    
</script>
</html>